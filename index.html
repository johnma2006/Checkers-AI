<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <title>Checkers AI</title>
    <link rel="stylesheet" type="text/css" href="style.css">
    <style type="text/css">
        body {
            background-color: #EDEDED;
        }

    </style>

</head>
<body>
    
    <canvas id="canvas1" width="1000" height="700" style="border:0px solid #c3c3c3; margin-left:27%;margin-top:20px;border:0px solid black"></canvas>
    
    <script>

        var c;
        var ctx;

        var height = 80;
        var fontSize = 80;
        var lineWidth = 16;
        var radius = 30;

        var board = Array();
        var selected = [-1, -1];
        var permSelected = false;
        var possibleMoves = Array();
        var hovor = [-1, -1];
        var haveToEat = false;

        var turn = 0;
        var numMovesLookAhead = 4;
        var moveTimer = 0;

        var king = new Image();

        var realBoard = Array();
        var tempBoard = Array();
        king.src = "king.png";

        var debug = "selected: " + selected;
        var debug2 = "score: 0";
        var debug3 = "";
        var debug4 = "";
        var debug5 = "";

        function initialize() {

            c = document.getElementById("canvas1");
            ctx = c.getContext("2d");

            initializeBoard();
            drawBoard();

            return setInterval(draw, 10);

        }
        function initializeBoard() {
            for (var i = 0; i < 8; i++) {
                board[i] = ['', '', '', '', '', '', '', '']
            }
            
            for (var i = 0; i < 3; i++)
                for (var j = i % 2; j < 8; j += 2)
                    board[j][i] = "1";
            
            for (var i = 5; i < 8; i++)
                for (var j = i % 2; j < 8; j += 2)
                    board[j][i] = "0";
           /*
            board[0][0] = "1";
            board[2][0] = "1";
            board[6][0] = "1";
            board[1][1] = "1";
            board[3][1] = "1";
            board[5][1] = "1";
            board[2][2] = "1";
            board[1][3] = "1";
            board[6][2] = "1";
            board[7][3] = "1";

            board[7][1] = "0";
            board[0][4] = "0";
            board[4][4] = "0";
            board[3][5] = "0";
            board[5][5] = "0";
            board[0][6] = "0";
            board[6][6] = "0";
            board[1][7] = "0";
            board[3][7] = "0";
            board[5][7] = "0";
            board[7][7] = "0";
            turn = "1";*/

                    
        }

        //Drawing functions
        function drawBoard() {
            ctx.fillStyle = "#A09A90";
            ctx.fillRect(0, 0, height * 8 + lineWidth * 2, height * 8 + lineWidth * 2);

            for (var i = 0; i < 8; i++) {
                for (var j = (i + 1) % 2; j < 8; j += 2) {
                    //Draw squares
                    ctx.fillStyle = "#E8D0A9";
                    ctx.fillRect(i * height + lineWidth, j * height + lineWidth, height, height);
                }
            }
        }
        function draw() {
            ctx.clearRect(680, 0, 1000, 1000);

            possibleMoves = getPossibleMoves(selected[0], selected[1]);

            haveToEat = false;
            for (var i = 0; i < 8; i++)
                for (var j = 0; j < 8; j++) 
                    if (board[i][j] == turn && returnIfHasKill(i, j))
                        haveToEat = true;
        
            drawPieces();
            ctx.fillStyle = '#000000';
            ctx.font = "bold 32px Calibri";
            ctx.fillText("Checkers", 690, 50);
            ctx.font = "19px Calibri";
            ctx.fillText("by John Ma", 690, 78);

            ctx.font = "bold 24px Calibri";
            ctx.fillText("Turn:", 690, 150);
            if (turn == "0") {
                ctx.beginPath();
                ctx.arc(764, 142, 12, 0, 2 * Math.PI, false);
                ctx.fillStyle = '#382F2F';
                ctx.fill();
                ctx.lineWidth = 3;
                ctx.strokeStyle = '#000000';
                ctx.stroke();
            }
            else {
                ctx.beginPath();
                ctx.arc(764, 142, 12, 0, 2 * Math.PI, false);
                ctx.fillStyle = '#800000';
                ctx.fill();
                ctx.lineWidth = 3;
                ctx.strokeStyle = '#380000';
                ctx.stroke();
            }

            debug2 = "score: " + score(board);
            debug3 = "hovor: " + hovor;

            ctx.fillStyle = '#000000';
            ctx.font = "14px Calibri";
            ctx.fillText(debug, 700, 350);
            ctx.fillText(debug2, 700, 370);
            ctx.fillText(debug3, 700, 390);
            ctx.fillText(debug4, 700, 410);
            ctx.fillText(debug5, 700, 430);

            if (turn == "1") {
                if (moveTimer < 5)
                    moveTimer++;
                if (moveTimer >= 5) {
                    var bestMove = getBestMove(board, numMovesLookAhead)[0];
                    debug4 = "bestMove: (" + bestMove[0] + ", " + bestMove[1] + "), directions: " + bestMove[2];
                    board = generateMove(board, bestMove[0], bestMove[1], bestMove[2]);
                    for (var i = 1; i < 4; i += 2)
                        if (board[i][7] == "1")
                            board[i][7] = "11";
                    turn = "0";
                    moveTimer = 0;
                }
                for (var i = 1; i < 8; i += 2)
                    if (board[i][7] == "1")
                        board[i][7] = "11";
            }
        }
        function drawPieces() {

            for (var i = 0; i < 8; i++) {
                for (var j = i % 2; j < 8; j += 2) {
                    //Draw squares
                    ctx.fillStyle = "#B7AFA3";
                    if (i == selected[0] && j == selected[1]) {
                        ctx.fillStyle = '#A8A094';
                    }
                    ctx.fillRect(i * height + lineWidth, j * height + lineWidth, height, height);


                    if (i == selected[0] && j == selected[1]) {
                        ctx.lineWidth = "1";
                        ctx.strokeStyle = "#59544D";
                        ctx.rect(i * height + lineWidth + 1, j * height + lineWidth + 1, height - 2, height - 2);
                        ctx.stroke();
                    }

                    //Draw circles
                    if (board[i][j][0] == "0") {
                        ctx.beginPath();
                        ctx.arc(i * height + 0.5 * height + lineWidth, j * height + 0.5 * height + lineWidth, radius, 0, 2 * Math.PI, false);
                        ctx.fillStyle = '#382F2F';
                        if (i == selected[0] && j == selected[1])
                            ctx.fillStyle = '#1F1616';
                        ctx.fill();
                        ctx.lineWidth = 3;
                        ctx.strokeStyle = '#000000';
                        ctx.stroke();
                    }
                    if (board[i][j][0] == "1") {
                        ctx.beginPath();
                        ctx.arc(i * height + 0.5 * height + lineWidth, j * height + 0.5 * height + lineWidth, radius, 0, 2 * Math.PI, false);
                        ctx.fillStyle = '#800000';
                        if (i == selected[0] && j == selected[1])
                            ctx.fillStyle = '#670000';
                        ctx.fill();
                        ctx.lineWidth = 3;
                        ctx.strokeStyle = '#380000';
                        ctx.stroke();
                    }
                    if (board[i][j] == "00" || board[i][j] == "11") {
                        ctx.drawImage(king, i * height + 0.27 * height + lineWidth, j * height + 0.23 * height + lineWidth);
                    }
                }

            }
            if (hovor[0] != -1 && selected[0] != -1) { //outline    
                if (board[selected[0]][selected[1]][0] == "0") {
                    ctx.beginPath();
                    ctx.arc(hovor[0] * height + 0.5 * height + lineWidth, hovor[1] * height + 0.5 * height + lineWidth, radius, 0, 2 * Math.PI, false);
                    ctx.fillStyle = '#A89F95';
                    ctx.fill();
                    ctx.lineWidth = 3;
                    ctx.strokeStyle = '#A19A8F';
                    ctx.stroke();
                }
                else if (board[selected[0]][selected[1]][0] == "1") {
                    ctx.beginPath();
                    ctx.arc(hovor[0] * height + 0.5 * height + lineWidth, hovor[1] * height + 0.5 * height + lineWidth, radius, 0, 2 * Math.PI, false);
                    ctx.fillStyle = '#B09A8F';
                    ctx.fill();
                    ctx.lineWidth = 3;
                    ctx.strokeStyle = '#A89A8F';
                    ctx.stroke();
                }
            }
            

        }

        //Game functions
        function addClickElementToBoard(ev) {
            var x = ev.clientX - c.offsetLeft;
            var y = ev.clientY - c.offsetTop;

            x = Math.floor((x - lineWidth) / height);
            y = Math.floor((y - lineWidth) / height);

            if (x == hovor[0] && y == hovor[1] && selected[0] != -1) { //Move
                if (board[selected[0]][selected[1]] == "0" && y == 0) //King me!
                    board[selected[0]][selected[1]] = "00";
                if (board[selected[0]][selected[1]] == "1" && y == 7)
                    board[selected[0]][selected[1]] = "11";

                if (Math.abs(hovor[0] - selected[0]) == 1) {
                    board[x][y] = board[selected[0]][selected[1]];
                    board[selected[0]][selected[1]] = "";
                    selected = [-1, -1];
                    hovor = [-1, -1];
                    turn = (turn + 1) % 2;
                }
                else {
                    board[x][y] = board[selected[0]][selected[1]];
                    board[(selected[0] + x) / 2][(selected[1] + y) / 2] = "";
                    board[selected[0]][selected[1]] = "";
                    hovor = [-1, -1];
                    possibleMoves = Array();

                    if (returnIfHasKill(x, y)) {
                        permSelected = true;
                        selected = [x, y];
                        hovor = [-1, -1];
                        debug4 = hovor;
                    }
                    else {
                        turn = (turn + 1) % 2;
                        permSelected = false;
                        selected = [-1, -1];
                    }
                }
            }
            else if (!permSelected) { //Select element
                if (x >= 0 && x < 8 && y >= 0 && y < 8 && (x + y) % 2 == 0 && board[x][y][0] == turn && board[x][y] != "" && (!haveToEat || returnIfHasKill(x, y))) {
                    selected = [x, y];
                    if (x == 1 && y == 5) {
                        //alert(getBestMove(board, 3));
                    }
                }
                else {
                    selected = [-1, -1];
                }
            }

            debug = "selected: [" + selected + "]";
        }
        function trackMouse(ev) {

            var x = ev.clientX - c.offsetLeft;
            var y = ev.clientY - c.offsetTop;

            x = Math.floor((x - lineWidth) / height);
            y = Math.floor((y - lineWidth) / height);

            var good = false;

            for (var i in possibleMoves) {
                if (x == possibleMoves[i][0] && y == possibleMoves[i][1]) {
                    good = true;
                    break;
                }
            }

            if (good)
                hovor = [x, y];
            else
                hovor = [-1, -1];
        }
        function getPossibleMoves(x, y) {
            var possibleMoves = Array();
            if (x == -1)
                return possibleMoves;
            else {
                hasKill = returnIfHasKill(x, y);
                if (board[x][y] == "0") {
                    if (x - 1 >= 0 && y - 1 >= 0) {
                        if (board[x - 1][y - 1] == "" && !hasKill)
                            possibleMoves.push([x - 1, y - 1]);
                        else if (board[x - 1][y - 1][0] == "1" && x - 2 >= 0 && y - 2 >= 0 && board[x - 2][y - 2] == "")
                            possibleMoves.push([x - 2, y - 2]);
                    }
                    if (x + 1 < 8 && y - 1 >= 0) {
                        if (board[x + 1][y - 1] == "" && !hasKill)
                            possibleMoves.push([x + 1, y - 1]);
                        else if (board[x + 1][y - 1][0] == "1" && x + 2 < 8 && y - 2 >= 0 && board[x + 2][y - 2] == "")
                            possibleMoves.push([x + 2, y - 2]);
                    }
                }
                else if (board[x][y] == "1") {
                    if (x - 1 >= 0 && y + 1 < 8) {
                        if (board[x - 1][y + 1] == "" && !hasKill)
                            possibleMoves.push([x - 1, y + 1]);
                        else if (board[x - 1][y + 1][0] == "0" && x - 2 >= 0 && y + 2 < 8 && board[x - 2][y + 2] == "")
                            possibleMoves.push([x - 2, y + 2]);
                    }
                    if (x + 1 < 8 && y + 1 < 8) {
                        if (board[x + 1][y + 1] == "" && !hasKill)
                            possibleMoves.push([x + 1, y + 1]);
                        else if (board[x + 1][y + 1][0] == "0" && x + 2 < 8 && y + 2 < 8 && board[x + 2][y + 2] == "")
                            possibleMoves.push([x + 2, y + 2]);
                    }
                }
                else if (board[x][y] == "00") {
                    if (x - 1 >= 0 && y - 1 >= 0) {
                        if (board[x - 1][y - 1] == "" && !hasKill)
                            possibleMoves.push([x - 1, y - 1]);
                        else if (board[x - 1][y - 1][0] == "1" && x - 2 >= 0 && y - 2 >= 0 && board[x - 2][y - 2] == "")
                            possibleMoves.push([x - 2, y - 2]);
                    }
                    if (x + 1 < 8 && y - 1 >= 0) {
                        if (board[x + 1][y - 1] == "" && !hasKill)
                            possibleMoves.push([x + 1, y - 1]);
                        else if (board[x + 1][y - 1][0] == "1" && x + 2 < 8 && y - 2 >= 0 && board[x + 2][y - 2] == "")
                            possibleMoves.push([x + 2, y - 2]);
                    }
                    if (x - 1 >= 0 && y + 1 < 8) {
                        if (board[x - 1][y + 1] == "" && !hasKill)
                            possibleMoves.push([x - 1, y + 1]);
                        else if (board[x - 1][y + 1][0] == "1" && x - 2 >= 0 && y + 2 < 8 && board[x - 2][y + 2] == "")
                            possibleMoves.push([x - 2, y + 2]);
                    }
                    if (x + 1 < 8 && y + 1 < 8) {
                        if (board[x + 1][y + 1] == "" && !hasKill)
                            possibleMoves.push([x + 1, y + 1]);
                        else if (board[x + 1][y + 1][0] == "1" && x + 2 < 8 && y + 2 < 8 && board[x + 2][y + 2] == "")
                            possibleMoves.push([x + 2, y + 2]);
                    }
                }
                else if (board[x][y] == "11") {
                    if (x - 1 >= 0 && y - 1 >= 0) {
                        if (board[x - 1][y - 1] == "" && !hasKill)
                            possibleMoves.push([x - 1, y - 1]);
                        else if (board[x - 1][y - 1][0] == "0" && x - 2 >= 0 && y - 2 >= 0 && board[x - 2][y - 2] == "")
                            possibleMoves.push([x - 2, y - 2]);
                    }
                    if (x + 1 < 8 && y - 1 >= 0) {
                        if (board[x + 1][y - 1] == "" && !hasKill)
                            possibleMoves.push([x + 1, y - 1]);
                        else if (board[x + 1][y - 1][0] == "0" && x + 2 < 8 && y - 2 >= 0 && board[x + 2][y - 2] == "")
                            possibleMoves.push([x + 2, y - 2]);
                    }
                    if (x - 1 >= 0 && y + 1 < 8) {
                        if (board[x - 1][y + 1] == "" && !hasKill)
                            possibleMoves.push([x - 1, y + 1]);
                        else if (board[x - 1][y + 1][0] == "0" && x - 2 >= 0 && y + 2 < 8 && board[x - 2][y + 2] == "")
                            possibleMoves.push([x - 2, y + 2]);
                    }
                    if (x + 1 < 8 && y + 1 < 8) {
                        if (board[x + 1][y + 1] == "" && !hasKill)
                            possibleMoves.push([x + 1, y + 1]);
                        else if (board[x + 1][y + 1][0] == "0" && x + 2 < 8 && y + 2 < 8 && board[x + 2][y + 2] == "")
                            possibleMoves.push([x + 2, y + 2]);
                    }
                }
            }
            return possibleMoves;
        }
        function returnIfHasKill(x, y) {
            if (x == -1)
                return false;
            else {
                if (board[x][y] == "0") {
                    if (x - 2 >= 0 && y - 2 >= 0 && board[x - 1][y - 1][0] == "1" && board[x - 2][y - 2] == "")
                        return true;
                    else if (x + 2 < 8 && y - 2 >= 0 && board[x + 1][y - 1][0] == "1" && board[x + 2][y - 2] == "")
                        return true;
                    else
                        return false;
                }
                else if (board[x][y] == "1") {
                    if (x - 2 >= 0 && y + 2 < 8 && board[x - 1][y + 1][0] == "0" && board[x - 2][y + 2] == "")
                        return true;
                    else if (x + 2 < 8 && y + 2 < 8 && board[x + 1][y + 1][0] == "0" && board[x + 2][y + 2] == "")
                        return true;
                    else
                        return false;
                }
                else if (board[x][y] == "00") {
                    if (x - 2 >= 0 && y - 2 >= 0 && board[x - 1][y - 1][0] == "1" && board[x - 2][y - 2] == "")
                        return true;
                    else if (x + 2 < 8 && y - 2 >= 0 && board[x + 1][y - 1][0] == "1" && board[x + 2][y - 2] == "")
                        return true;
                    else if (x - 2 >= 0 && y + 2 < 8 && board[x - 1][y + 1][0] == "1" && board[x - 2][y + 2] == "")
                        return true;
                    else if (x + 2 < 8 && y + 2 < 8 && board[x + 1][y + 1][0] == "1" && board[x + 2][y + 2] == "")
                        return true;
                    else
                        return false;
                }
                else if (board[x][y] == "11") {
                    if (x - 2 >= 0 && y - 2 >= 0 && board[x - 1][y - 1][0] == "0" && board[x - 2][y - 2] == "")
                        return true;
                    else if (x + 2 < 8 && y - 2 >= 0 && board[x + 1][y - 1][0] == "0" && board[x + 2][y - 2] == "")
                        return true;
                    else if (x - 2 >= 0 && y + 2 < 8 && board[x - 1][y + 1][0] == "0" && board[x - 2][y + 2] == "")
                        return true;
                    else if (x + 2 < 8 && y + 2 < 8 && board[x + 1][y + 1][0] == "0" && board[x + 2][y + 2] == "")
                        return true;
                    else
                        return false;
                }
            }
        }

        function doKeyDown(evt) {
            switch (evt.keyCode) {
                case 49: //1
                    realBoard = board;
                    board = tempBoard;
                    debug = "tempBoard";
                    break;
                case 50: //2
                    board = realBoard;
                    debug = "realBoard";
                    break;
                case 51: //3
                    if (turn == "1") {
                        var bestMove = getBestMove(board, 4)[0];
                        debug4 = "(x, y): (" + bestMove[0] + ", " + bestMove[1] + "), directions: " + bestMove[2];
                        board = generateMove(board, bestMove[0], bestMove[1], bestMove[2]);
                        for (var i = 1; i < 4; i += 2)
                            if (board[i][7] == "1")
                                board[i][7] = "11";
                        turn = "0";
                    }
                    break;

            }
        }

        //AI functions - 0, 1, 2, 3 = topleft, topright, bottomright, bottomleft
        function generateMove(testBoard, x, y, directions) {
            var newTestBoard = Array();
            for (var i2 = 0; i2 < 8; i2++)
                newTestBoard[i2] = testBoard[i2].slice();

            for (var i in directions) {
                current = newTestBoard[x][y][0];

                if (directions[i] == 0) {
                    if ((current == "0" && newTestBoard[x - 1][y - 1][0] == "1") || (current == "1" && newTestBoard[x - 1][y - 1][0] == "0")) {
                        newTestBoard[x - 1][y - 1] = "";
                        newTestBoard[x - 2][y - 2] = newTestBoard[x][y];
                        var x2 = x - 2;
                        var y2 = y - 2;
                    }
                    else {
                        newTestBoard[x - 1][y - 1] = newTestBoard[x][y];
                        var x2 = x - 1;
                        var y2 = y - 1;
                    }
                }
                else if (directions[i] == 1) {
                    if ((current == "0" && newTestBoard[x + 1][y - 1][0] == "1") || (current == "1" && newTestBoard[x + 1][y - 1][0] == "0")) {
                        newTestBoard[x + 1][y - 1] = "";
                        newTestBoard[x + 2][y - 2] = newTestBoard[x][y];
                        var x2 = x + 2;
                        var y2 = y - 2;
                    }
                    else {
                        newTestBoard[x + 1][y - 1] = newTestBoard[x][y];
                        var x2 = x + 1;
                        var y2 = y - 1;
                    }
                }
                else if (directions[i] == 2) {
                    if ((current == "0" && newTestBoard[x + 1][y + 1][0] == "1") || (current == "1" && newTestBoard[x + 1][y + 1][0] == "0")) {
                        newTestBoard[x + 1][y + 1] = "";
                        newTestBoard[x + 2][y + 2] = newTestBoard[x][y];
                        var x2 = x + 2;
                        var y2 = y + 2;
                    }
                    else {
                        newTestBoard[x + 1][y + 1] = newTestBoard[x][y];
                        var x2 = x + 1;
                        var y2 = y + 1;
                    }
                }
                else if (directions[i] == 3) {
                    if ((current == "0" && newTestBoard[x - 1][y + 1][0] == "1") || (current == "1" && newTestBoard[x - 1][y + 1][0] == "0")) {
                        newTestBoard[x - 1][y + 1] = "";
                        newTestBoard[x - 2][y + 2] = newTestBoard[x][y];
                        var x2 = x - 2;
                        var y2 = y + 2;
                    }
                    else {
                        newTestBoard[x - 1][y + 1] = newTestBoard[x][y];
                        var x2 = x - 1;
                        var y2 = y + 1;
                    }
                }

                newTestBoard[x][y] = "";
                x = x2;
                y = y2;
            }
            return newTestBoard;

        }
        function getAllPossibleMoves(testBoard, turn) {

            allPossibleMoves = Array();

            if (!testIfHaveToKill(testBoard, turn)) {
                for (var i = 0; i < 8; i++)
                    for (var j = i % 2; j < 8; j += 2) {
                        if (testBoard[i][j][0] == turn) {
                            var pMoves = getPossibleAllMovesSingle(testBoard, i, j);

                            for (var k in pMoves) {
                                allPossibleMoves.push([generateMove(testBoard, i, j, pMoves[k]), [i, j], pMoves[k]]);

                           } 
                        }
                    }
            }
            else {
                for (var i = 0; i < 8; i++)
                    for (var j = i % 2; j < 8; j += 2) {
                        if (testBoard[i][j][0] == turn && returnIfHasKill2(testBoard, i, j)) {
                            var pMoves = getPossibleAllMovesSingle(testBoard, i, j);

                            for (var k in pMoves) {
                                allPossibleMoves.push([generateMove(testBoard, i, j, pMoves[k]), [i, j], pMoves[k]]);
                            }
                        }
                    }
            }
            return allPossibleMoves;
        }   //returns array [board, [x, y], [directions]]
        function getPossibleAllMovesSingle(testBoard, x, y) {
            //returns directions 
            var pMoves = getPossibleMoves2(testBoard, x, y);
            var possibleDirections = Array();

            for (var i in pMoves) {
                var dx = pMoves[i][0] - x;
                var dy = pMoves[i][1] - y;

                var dir = [0];
                if (dx / Math.abs(dx) == 1 && dy / Math.abs(dy) == -1)
                    dir = [1];
                else if (dx / Math.abs(dx) == 1 && dy / Math.abs(dy) == 1)
                    dir = [2];
                else if (dx / Math.abs(dx) == -1 && dy / Math.abs(dy) == 1)
                    dir = [3];

                var newTestBoard = generateMove(testBoard, x, y, dir);

                if (Math.abs(dx) == 2 && returnIfHasKill2(newTestBoard, pMoves[i][0], pMoves[i][1])) {
                    var newPossDirs = getPossibleAllMovesSingle(newTestBoard, pMoves[i][0], pMoves[i][1]);
                    for (var j in newPossDirs) {
                        var valid = false;

                        if (newPossDirs[j][0] == 0) {
                            if (newTestBoard[pMoves[i][0] - 1][pMoves[i][1] - 1] != "")
                                valid = true;
                        }
                        else if (newPossDirs[j][0] == 1) {
                            if (newTestBoard[pMoves[i][0] + 1][pMoves[i][1] - 1] != "")
                                valid = true;
                        }
                        else if (newPossDirs[j][0] == 2) {
                            if (newTestBoard[pMoves[i][0] + 1][pMoves[i][1] + 1] != "")
                                valid = true;
                        }
                        else {
                            if (newTestBoard[pMoves[i][0] - 1][pMoves[i][1] + 1] != "")
                                valid = true;
                        }

                        if (valid)
                            possibleDirections.push(dir.concat(newPossDirs[j]));
                    }
                }
                else
                    possibleDirections.push(dir);
            }

            return possibleDirections;
        }
        function getPossibleMoves2(testBoard, x, y) {
            var possibleMoves = Array();
            if (x == -1)
                return possibleMoves;
            else {
                hasKill = returnIfHasKill2(testBoard, x, y);
                if (testBoard[x][y] == "0") {
                    if (x - 1 >= 0 && y - 1 >= 0) {
                        if (testBoard[x - 1][y - 1] == "" && !hasKill)
                            possibleMoves.push([x - 1, y - 1]);
                        else if (testBoard[x - 1][y - 1][0] == "1" && x - 2 >= 0 && y - 2 >= 0 && testBoard[x - 2][y - 2] == "")
                            possibleMoves.push([x - 2, y - 2]);
                    }
                    if (x + 1 < 8 && y - 1 >= 0) {
                        if (testBoard[x + 1][y - 1] == "" && !hasKill)
                            possibleMoves.push([x + 1, y - 1]);
                        else if (testBoard[x + 1][y - 1][0] == "1" && x + 2 < 8 && y - 2 >= 0 && testBoard[x + 2][y - 2] == "")
                            possibleMoves.push([x + 2, y - 2]);
                    }
                }
                else if (testBoard[x][y] == "1") {
                    if (x - 1 >= 0 && y + 1 < 8) {
                        if (testBoard[x - 1][y + 1] == "" && !hasKill)
                            possibleMoves.push([x - 1, y + 1]);
                        else if (testBoard[x - 1][y + 1][0] == "0" && x - 2 >= 0 && y + 2 < 8 && testBoard[x - 2][y + 2] == "")
                            possibleMoves.push([x - 2, y + 2]);
                    }
                    if (x + 1 < 8 && y + 1 < 8) {
                        if (testBoard[x + 1][y + 1] == "" && !hasKill)
                            possibleMoves.push([x + 1, y + 1]);
                        else if (testBoard[x + 1][y + 1][0] == "0" && x + 2 < 8 && y + 2 < 8 && testBoard[x + 2][y + 2] == "")
                            possibleMoves.push([x + 2, y + 2]);
                    }
                }
                else if (testBoard[x][y] == "00") {
                    if (x - 1 >= 0 && y - 1 >= 0) {
                        if (testBoard[x - 1][y - 1] == "" && !hasKill)
                            possibleMoves.push([x - 1, y - 1]);
                        else if (testBoard[x - 1][y - 1][0] == "1" && x - 2 >= 0 && y - 2 >= 0 && testBoard[x - 2][y - 2] == "")
                            possibleMoves.push([x - 2, y - 2]);
                    }
                    if (x + 1 < 8 && y - 1 >= 0) {
                        if (testBoard[x + 1][y - 1] == "" && !hasKill)
                            possibleMoves.push([x + 1, y - 1]);
                        else if (testBoard[x + 1][y - 1][0] == "1" && x + 2 < 8 && y - 2 >= 0 && testBoard[x + 2][y - 2] == "")
                            possibleMoves.push([x + 2, y - 2]);
                    }
                    if (x - 1 >= 0 && y + 1 < 8) {
                        if (testBoard[x - 1][y + 1] == "" && !hasKill)
                            possibleMoves.push([x - 1, y + 1]);
                        else if (testBoard[x - 1][y + 1][0] == "1" && x - 2 >= 0 && y + 2 < 8 && testBoard[x - 2][y + 2] == "")
                            possibleMoves.push([x - 2, y + 2]);
                    }
                    if (x + 1 < 8 && y + 1 < 8) {
                        if (testBoard[x + 1][y + 1] == "" && !hasKill)
                            possibleMoves.push([x + 1, y + 1]);
                        else if (testBoard[x + 1][y + 1][0] == "1" && x + 2 < 8 && y + 2 < 8 && testBoard[x + 2][y + 2] == "")
                            possibleMoves.push([x + 2, y + 2]);
                    }
                }
                else if (testBoard[x][y] == "11") {
                    if (x - 1 >= 0 && y - 1 >= 0) {
                        if (testBoard[x - 1][y - 1] == "" && !hasKill)
                            possibleMoves.push([x - 1, y - 1]);
                        else if (testBoard[x - 1][y - 1][0] == "0" && x - 2 >= 0 && y - 2 >= 0 && testBoard[x - 2][y - 2] == "")
                            possibleMoves.push([x - 2, y - 2]);
                    }
                    if (x + 1 < 8 && y - 1 >= 0) {
                        if (testBoard[x + 1][y - 1] == "" && !hasKill)
                            possibleMoves.push([x + 1, y - 1]);
                        else if (testBoard[x + 1][y - 1][0] == "0" && x + 2 < 8 && y - 2 >= 0 && testBoard[x + 2][y - 2] == "")
                            possibleMoves.push([x + 2, y - 2]);
                    }
                    if (x - 1 >= 0 && y + 1 < 8) {
                        if (testBoard[x - 1][y + 1] == "" && !hasKill)
                            possibleMoves.push([x - 1, y + 1]);
                        else if (testBoard[x - 1][y + 1][0] == "0" && x - 2 >= 0 && y + 2 < 8 && testBoard[x - 2][y + 2] == "")
                            possibleMoves.push([x - 2, y + 2]);
                    }
                    if (x + 1 < 8 && y + 1 < 8) {
                        if (testBoard[x + 1][y + 1] == "" && !hasKill)
                            possibleMoves.push([x + 1, y + 1]);
                        else if (testBoard[x + 1][y + 1][0] == "0" && x + 2 < 8 && y + 2 < 8 && testBoard[x + 2][y + 2] == "")
                            possibleMoves.push([x + 2, y + 2]);
                    }
                }
            }
            return possibleMoves;
        }
        function getBestMove(testBoard, iterations) { //Returns [[x, y, directions], score]
            if (iterations == 1) {
                return [[], score(testBoard)];
            }
            else {
                var arrayOfNewTestBoardScores = Array();

                var allPossibleMoves1 = getAllPossibleMoves(testBoard, "1");

                var maxScore = 0;
                var bestMove = Array();
                var allScores = Array();

                var test = "";
                for (var i in allPossibleMoves1) {
                    var newBoard = generateMove(testBoard, allPossibleMoves1[i][1][0], allPossibleMoves1[i][1][1], allPossibleMoves1[i][2]);

                    var allPossibleMoves2 = getAllPossibleMoves(newBoard, "0");

                    var minScore = 9999999;
                    var worstMove;
                    for (var j in allPossibleMoves2) {
                        var newBoard2 = generateMove(newBoard, allPossibleMoves2[j][1][0], allPossibleMoves2[j][1][1], allPossibleMoves2[j][2]);
                        var subWorstMove = getBestMove(newBoard2, iterations - 1);

                        if (subWorstMove[1] < minScore) {
                            minScore = subWorstMove[1];
                            worstmove = subWorstMove[0];
                        }
                    }
                    allScores.push(minScore);
                    if (minScore > maxScore) {
                        maxScore = minScore;
                        bestMove = [[allPossibleMoves1[i][1][0], allPossibleMoves1[i][1][1], allPossibleMoves1[i][2]]];
                    }
                    else if (minScore == maxScore) {
                        bestMove.push([allPossibleMoves1[i][1][0], allPossibleMoves1[i][1][1], allPossibleMoves1[i][2]]);
                    }
                }
                var index = Math.floor(Math.random() * bestMove.length);
                debug5 = "(totalMoves, bestMoves, maxScore): (" + allScores.length + ", " + bestMove.length + ", " + maxScore + ")";
                return [bestMove[index], maxScore];
            }
        } //returns [x, y, direction]
        function returnIfHasKill2(testBoard, x, y) {
            if (x == -1)
                return false;
            else {
                if (testBoard[x][y] == "0") {
                    if (x - 2 >= 0 && y - 2 >= 0 && testBoard[x - 1][y - 1][0] == "1" && testBoard[x - 2][y - 2] == "")
                        return true;
                    else if (x + 2 < 8 && y - 2 >= 0 && testBoard[x + 1][y - 1][0] == "1" && testBoard[x + 2][y - 2] == "")
                        return true;
                    else
                        return false;
                }
                else if (testBoard[x][y] == "1") {
                    if (x - 2 >= 0 && y + 2 < 8 && testBoard[x - 1][y + 1][0] == "0" && testBoard[x - 2][y + 2] == "")
                        return true;
                    else if (x + 2 < 8 && y + 2 < 8 && testBoard[x + 1][y + 1][0] == "0" && testBoard[x + 2][y + 2] == "")
                        return true;
                    else
                        return false;
                }
                else if (testBoard[x][y] == "00") {
                    if (x - 2 >= 0 && y - 2 >= 0 && testBoard[x - 1][y - 1][0] == "1" && testBoard[x - 2][y - 2] == "")
                        return true;
                    else if (x + 2 < 8 && y - 2 >= 0 && testBoard[x + 1][y - 1][0] == "1" && testBoard[x + 2][y - 2] == "")
                        return true;
                    else if (x - 2 >= 0 && y + 2 < 8 && testBoard[x - 1][y + 1][0] == "1" && testBoard[x - 2][y + 2] == "")
                        return true;
                    else if (x + 2 < 8 && y + 2 < 8 && testBoard[x + 1][y + 1][0] == "1" && testBoard[x + 2][y + 2] == "")
                        return true;
                    else
                        return false;
                }
                else if (testBoard[x][y] == "11") {
                    if (x - 2 >= 0 && y - 2 >= 0 && testBoard[x - 1][y - 1][0] == "0" && testBoard[x - 2][y - 2] == "")
                        return true;
                    else if (x + 2 < 8 && y - 2 >= 0 && testBoard[x + 1][y - 1][0] == "0" && testBoard[x + 2][y - 2] == "")
                        return true;
                    else if (x - 2 >= 0 && y + 2 < 8 && testBoard[x - 1][y + 1][0] == "0" && testBoard[x - 2][y + 2] == "")
                        return true;
                    else if (x + 2 < 8 && y + 2 < 8 && testBoard[x + 1][y + 1][0] == "0" && testBoard[x + 2][y + 2] == "")
                        return true;
                    else
                        return false;
                }
            }
        }
        function testIfHaveToKill(testBoard, turn) {
            for (var i = 0; i < 8; i++)
                for (var j = 0; j < 8; j++)
                    if (testBoard[i][j] == turn && returnIfHasKill2(testBoard, i, j))
                        return true;
            return false;
        } 
        function score(testBoard) {
            var n1 = 0.0;
            var n0 = 0.0;

            //Normal pieces = 1.0, Kings = 2.0
            for (var i = 0; i < 8; i++)
                for (var j = i % 2; j < 8; j += 2) {
                    if (testBoard[i][j] == "0")
                        n0 += 1.0;
                    if (testBoard[i][j] == "00")
                        n0 += 2.2;
                    if (testBoard[i][j] == "1")
                        n1 += 1.0;
                    if (testBoard[i][j] == "11")
                        n1 += 2.2;

                }
            //Pieces on home row are weighted more
            for (var i = 0; i < 8; i++) {
                if (testBoard[i][0] == "1")
                    n1 += 1.0;
                if (testBoard[i][7] == "0")
                    n0 += 1.0;
            }

            if (n0 < 0.5)
                return 9001.0;
            return n1 / n0;
        }

        initialize();

        window.addEventListener('keydown', doKeyDown, true);
        window.addEventListener('click', addClickElementToBoard, true);
        window.addEventListener('mousemove', trackMouse, true);
        
        //CAN IT PEE?
        //CAN IT REACH THE POOPY SKY?
        //CAN IT REACH A LION?
        //CAN IT PUSH A CHAIR?
        //CAN IT REACH THE EARTH

    </script>

</body>
</html>
